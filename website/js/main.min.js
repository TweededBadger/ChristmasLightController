var stage;var rect;var count=0;var colors=[];var theLoc;init=function(){stage=new createjs.Stage("testCanvas");rect=new createjs.Shape();rect.graphics.beginLinearGradientFill(["rgba(255,0,0,1)","rgba(0,255,0,1)"],[0,1],0,0,240,0).drawRect(0,0,240,100);stage.addChild(rect);stage.update();$("#btn_add").click(addcolour);$("#btn_process").click(processColor);$("#btn_join").click(joinQueue);$("#btn_join2").click(joinQueue);$("#sliders").delegate("button","click",function(b){var a=$(this).data("type");var c=$(this).data("id");switch(a){case"delete":removeColour(c);break;case"copy":addcolour(null,$("#cp"+c).val(),c);break}});$(window).scroll(function(){theLoc=$("#creator").offset().top;console.log(theLoc);if(theLoc>=$(window).scrollTop()){$("#gradientHolder").removeClass("fixed");$("#container").removeClass("fixed");$("#streamframeholder").removeClass("fixed");$("#sliders").removeClass("fixed");$("#creator").removeClass("fixed")}else{$("#gradientHolder").addClass("fixed");$("#container").addClass("fixed");$("#streamframeholder").addClass("fixed");$("#sliders").addClass("fixed");$("#creator").addClass("fixed")}});initSocket()};debug=function(b,a){if(a){$("#debugtxt").html("")}$("#debugtxt").html($("#debugtxt").html()+"<br>"+b)};var intensity=0.3;processColor=function(){rect.cache(0,0,240,100);var f=rect.cacheCanvas.getContext("2d").getImageData(0,0,240,1);var l="";var d=8;for(var e=0;e<d;e++){for(var h=0;h<240/d;h++){var c=Math.round(f.data[h*4*d]*intensity);var k=Math.round(f.data[(h*4*d)+1]*intensity);var m=Math.round(f.data[(h*4*d)+2]*intensity);var n=Math.round(f.data[(h*4*d)+3]*intensity);l+="i"+((h+1)+(e*240/d))+"r"+c+"g"+k+"b"+m}}console.log(l);sendColorString(l)};removeColour=function(c){var a;for(var b in colors){console.log(colors[b]);console.log(b);if(colors[b].id==c){a=b}}colors.splice(a,1);$("#h"+c).remove();slide()};addcolour=function(f,b,l){var a="slider"+count;var g="cp"+count;var d="p"+count;var k="h"+count;var h="#000000";if(b){h=b}else{h=tinycolor.random().toHexString();console.log(tinycolor.random().toHexString())}$.minicolors.defaults.defaultValue=h;console.log(h);sliderhtml='<div class="sliderholder"  id="'+k+'" ><div class="triangle"></div> <button class="btn copy" data-id='+count+' data-type="copy" ><span class="icon-copy"></span></button><input id="'+g+'" data-defaultvalue="'+h+'"/><button class="btn delete" data-id='+count+' data-type="delete" ><span class="icon-trash"></span></button><div><input id="'+a+'" data-slider-id="the'+a+'" type="text" data-slider-tooltip="hide" data-slider-min="0" data-slider-max="240" data-slider-step="1" data-slider-value="0"/></div></div>';if(l){$(sliderhtml).insertAfter("#h"+l)}else{$("#sliders").append($(sliderhtml));window.scrollTo(0,document.body.scrollHeight)}var m=$("#"+a).slider({value:Math.random()*255}).on("slide",slide).data("slider");var j=$("#"+g).minicolors({change:function(e,c){slide()}});var i=new SColor();i.slider=m;i.holder=$("#"+k);i.colorpicker=j;i.id=count;colors.push(i);count++;slide()};slide=function(){rect.uncache();var a=buildGradientArray();var b=buildColorArray();rect.graphics.clear();rect.graphics.beginLinearGradientFill(b,a,0,0,240,0).drawRect(0,0,240,120);stage.update()};buildGradientArray=function(){var a=[];for(var c in colors){var b=colors[c].slider.getValue()/240;a.push(b)}return a};buildColorArray=function(){var a=[];for(var c in colors){var b=colors[c].colorpicker.val();a.push(b);$(colors[c].slider.handle1).css("background-color",colors[c].colorpicker.val());$(colors[c].slider.handle1).css("background-image","none");$(colors[c].holder).find(".triangle").css("border-color",colors[c].colorpicker.val()+" transparent transparent transparent")}return a};SColor=function(){this.slider=null;this.colorpicker=null};$(document).ready(init);